CREATE TABLE JXZLPJ.SCJY_ZDXSCY (
    CODE VARCHAR2(16 BYTE) NOT NULL ,
    COLLEGE VARCHAR2(32 BYTE) NULL ,
    MAJOR VARCHAR2(32 BYTE) NULL ,
    STU_CODE VARCHAR2(16 BYTE) NULL ,
    STU_NAME VARCHAR2(16 BYTE) NULL ,
    COMPANY_NAME VARCHAR2(64 BYTE) NULL ,
    REGIST_DATE DATE NULL ,
    USER_ID VARCHAR2(16 BYTE) NULL ,
    USER_NAME VARCHAR2(16 BYTE) NULL ,
    CREATE_DATE DATE NULL 
)

--
CREATE OR REPLACE VIEW V_SCJY_ZDXSCY AS 
SELECT j.*
,(case when sh.shenhe_code is not null and sh.status !='退回' then '已提交' else '未提交' end ) is_submit
,sh.shenhe_code,sh.batch_num,sh.status
from SCJY_ZDXSCY j 
LEFT JOIN (
	SELECT code,MAX(BATCH_NUM) BATCH_NUM
	from SCJY_ZDXSCY j
	LEFT JOIN COMMON_SHENHE sh on sh.relation_code = j.code
	GROUP BY code
 ) t on t.code = j.code
LEFT JOIN COMMON_SHENHE sh on sh.RELATION_CODE = t.code and sh.BATCH_NUM = t.BATCH_NUM;
--
CREATE OR REPLACE VIEW V_SCJY_ZDXSCY_SHENHE AS 
SELECT j.*
,sh.shenhe_code,sh.batch_num,sh.status
from (
	SELECT code,MAX(BATCH_NUM) BATCH_NUM
	from SCJY_ZDXSCY j
	LEFT JOIN COMMON_SHENHE sh on sh.relation_code = j.code
	where sh.relation_code is not null
	GROUP BY code
 ) t 
LEFT JOIN SCJY_ZDXSCY j on j.code = t.code
LEFT JOIN COMMON_SHENHE sh on sh.RELATION_CODE = t.code and sh.BATCH_NUM = t.BATCH_NUM;