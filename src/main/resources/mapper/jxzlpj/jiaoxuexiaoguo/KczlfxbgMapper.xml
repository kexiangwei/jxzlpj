<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.mycode.jxzlpj.jiaoxuexiaoguo.kczlfxbg.mapper.KczlfxbgMapper">

    <!--
    ORDER BY isTxbg 会报错：[Err] ORA-00904: "ISTXBG": invalid identifier
    需要改为：ORDER BY "isTxbg"
    -->
    <select id="getPageList" resultType="com.mycode.jxzlpj.jiaoxuexiaoguo.kczlfxbg.doman.Kczlfxbg">
        SELECT * FROM (
            SELECT DISTINCT kc.course_code, kc.course_name, kc.course_attr, kc.XN, kc.XQ, kc.xy_name, kc.zy_name
            , wm_concat(DISTINCT kc.SKJS_NAME) as "skjsAll", wm_concat(DISTINCT kc.sk_bj) as "skbjAll"
            , max(case when bg.COURSE_CODE is not null then 1 else 2 end) as "isTxbg", max(bg.code) as "bgCode"
            FROM SYS_DATA_XNXQ t
            LEFT JOIN SYS_DATA_JSRK rk on rk.XN = t.XN and rk.XQ = t.XQ
            LEFT JOIN SYS_DATA_JS js on js.USER_ID = rk.USER_ID
            LEFT JOIN SYS_DATA_KC kc on kc.course_code = rk.course_code and kc.XN = rk.XN and KC.XQ = rk.XQ and kc.SKJS_CODE = rk.USER_ID
            LEFT JOIN JXXG_KCZLFXBG bg on bg.course_code = kc.course_code and bg.XN = kc.XN and bg.XQ = kc.XQ
            <where> (current_date - interval '1' year) between begin_date and end_date
                <if test="courseName != null and courseName != ''">
                    and kc.COURSE_NAME like concat(concat('%',#{courseName}),'%')
                </if>
            </where>
            GROUP BY kc.course_code, kc.course_name, kc.course_attr, kc.XN, kc.XQ, kc.xy_name, kc.zy_name
            ORDER BY kc.course_code
        ) t ORDER BY "isTxbg"
    </select>

    <resultMap id="resultMap" type="com.mycode.jxzlpj.jiaoxuexiaoguo.kczlfxbg.doman.Kczlfxbg">
        <id column="code" property="code"/>
        <result column="b1_1_1" property="b1_1_1"/>
        <result column="b1_1_2" property="b1_1_2"/>
        <result column="b1_1_3" property="b1_1_3"/>
        <result column="b1_1_4_1" property="b1_1_4_1"/>
        <result column="b1_1_4_2" property="b1_1_4_2"/>
        <result column="b1_1_5" property="b1_1_5"/>
        <result column="b1_1_6_1" property="b1_1_6_1"/>
        <result column="b1_1_6_2" property="b1_1_6_2"/>
        <result column="b1_1_6_3" property="b1_1_6_3"/>
        <result column="b1_1_6_4" property="b1_1_6_4"/>
        <result column="b1_1_6_5" property="b1_1_6_5"/>
        <result column="b1_1_6_6" property="b1_1_6_6"/>
        <result column="b1_1_6_7" property="b1_1_6_7"/>
        <result column="b1_1_7_1" property="b1_1_7_1"/>
        <result column="b1_1_7_2" property="b1_1_7_2"/>
        <result column="b1_1_7_3" property="b1_1_7_3"/>
        <result column="b1_1_7_4" property="b1_1_7_4"/>
        <result column="b1_1_7_5" property="b1_1_7_5"/>
        <result column="b1_1_7_6" property="b1_1_7_6"/>
        <result column="b1_1_7_7" property="b1_1_7_7"/>
        <result column="b1_1_8" property="b1_1_8"/>
        <result column="b1_1_9" property="b1_1_9"/>
        <result column="b1_1_10" property="b1_1_10"/>
        <result column="b1_2_1_1" property="b1_2_1_1"/>
        <result column="b1_2_1_2" property="b1_2_1_2"/>
        <result column="b1_2_1_3" property="b1_2_1_3"/>
        <result column="b1_2_1_4" property="b1_2_1_4"/>
        <result column="b1_2_1_5" property="b1_2_1_5"/>
        <result column="b1_2_1_6" property="b1_2_1_6"/>
        <result column="b1_2_1_7" property="b1_2_1_7"/>
        <result column="b1_2_2_1" property="b1_2_2_1"/>
        <result column="b1_2_2_2" property="b1_2_2_2"/>
        <result column="b1_2_2_3" property="b1_2_2_3"/>
        <result column="b1_2_2_4" property="b1_2_2_4"/>
        <result column="b1_2_2_5" property="b1_2_2_5"/>
        <result column="b1_2_2_6" property="b1_2_2_6"/>
        <result column="b1_2_2_7" property="b1_2_2_7"/>
        <result column="b1_2_3" property="b1_2_3"/>
        <result column="b1_2_4" property="b1_2_4"/>
        <result column="b1_2_5" property="b1_2_5"/>
        <result column="b1_3_1_1" property="b1_3_1_1"/>
        <result column="b1_3_1_2" property="b1_3_1_2"/>
        <result column="b1_3_1_3" property="b1_3_1_3"/>
        <result column="b1_3_1_4" property="b1_3_1_4"/>
        <result column="b1_3_1_5" property="b1_3_1_5"/>
        <result column="b1_3_1_6" property="b1_3_1_6"/>
        <result column="b1_3_1_7" property="b1_3_1_7"/>
        <result column="b1_3_2_1" property="b1_3_2_1"/>
        <result column="b1_3_2_2" property="b1_3_2_2"/>
        <result column="b1_3_2_3" property="b1_3_2_3"/>
        <result column="b1_3_2_4" property="b1_3_2_4"/>
        <result column="b1_3_2_5" property="b1_3_2_5"/>
        <result column="b1_3_2_6" property="b1_3_2_6"/>
        <result column="b1_3_2_7" property="b1_3_2_7"/>
        <result column="b1_3_3" property="b1_3_3"/>
        <result column="b1_3_4" property="b1_3_4"/>
        <result column="b1_3_5" property="b1_3_5"/>
        <result column="b1_4_1_1" property="b1_4_1_1"/>
        <result column="b1_4_1_2" property="b1_4_1_2"/>
        <result column="b1_4_1_3" property="b1_4_1_3"/>
        <result column="b1_4_1_4" property="b1_4_1_4"/>
        <result column="b1_4_1_5" property="b1_4_1_5"/>
        <result column="b1_4_1_6" property="b1_4_1_6"/>
        <result column="b1_4_1_7" property="b1_4_1_7"/>
        <result column="b1_4_2_1" property="b1_4_2_1"/>
        <result column="b1_4_2_2" property="b1_4_2_2"/>
        <result column="b1_4_2_3" property="b1_4_2_3"/>
        <result column="b1_4_2_4" property="b1_4_2_4"/>
        <result column="b1_4_2_5" property="b1_4_2_5"/>
        <result column="b1_4_2_6" property="b1_4_2_6"/>
        <result column="b1_4_2_7" property="b1_4_2_7"/>
        <result column="b1_4_3" property="b1_4_3"/>
        <result column="b1_4_4" property="b1_4_4"/>
        <result column="b1_4_5" property="b1_4_5"/>
        <result column="b2_1" property="b2_1"/>
        <result column="b2_2" property="b2_2"/>
        <result column="b2_3" property="b2_3"/>
        <result column="b2_4" property="b2_4"/>
        <result column="b2_5" property="b2_5"/>
        <result column="b2_6" property="b2_6"/>
        <result column="c1_1" property="c1_1"/>
        <result column="c1_2" property="c1_2"/>
        <result column="c1_3" property="c1_3"/>
        <result column="c1_4" property="c1_4"/>
        <result column="c1_5" property="c1_5"/>
        <result column="c1_6" property="c1_6"/>
        <result column="c1_7" property="c1_7"/>
        <result column="c1_8" property="c1_8"/>
        <result column="c1_9" property="c1_9"/>
    </resultMap>

    <select id="getKczlfxbg" resultMap="resultMap">
        select * from JXXG_KCZLFXBG where code = #{code}
    </select>

    <insert id="insert">
          insert into JXXG_KCZLFXBG (CODE, COURSE_CODE, COURSE_NAME, COURSE_ATTR, XN, XQ, XY_NAME, ZY_NAME, SKJS_ALL, SKBJ_ALL
          , B1_1_1, B1_1_2, B1_1_3, B1_1_4_1, B1_1_4_2, B1_1_5
          , B1_1_6_1, B1_1_6_2, B1_1_6_3, B1_1_6_4, B1_1_6_5, B1_1_6_6, B1_1_6_7
          , B1_1_7_1, B1_1_7_2, B1_1_7_3, B1_1_7_4, B1_1_7_5, B1_1_7_6, B1_1_7_7
          , B1_1_8, B1_1_9, B1_1_10
          , B1_2_1_1, B1_2_1_2, B1_2_1_3, B1_2_1_4, B1_2_1_5, B1_2_1_6, B1_2_1_7
          , B1_2_2_1, B1_2_2_2, B1_2_2_3, B1_2_2_4, B1_2_2_5, B1_2_2_6, B1_2_2_7
          , B1_2_3, B1_2_4, B1_2_5
          , B1_3_1_1, B1_3_1_2, B1_3_1_3, B1_3_1_4, B1_3_1_5, B1_3_1_6, B1_3_1_7
          , B1_3_2_1, B1_3_2_2, B1_3_2_3, B1_3_2_4, B1_3_2_5, B1_3_2_6, B1_3_2_7
          , B1_3_3, B1_3_4, B1_3_5
          , B1_4_1_1, B1_4_1_2, B1_4_1_3, B1_4_1_4, B1_4_1_5, B1_4_1_6, B1_4_1_7
          , B1_4_2_1, B1_4_2_2, B1_4_2_3, B1_4_2_4, B1_4_2_5, B1_4_2_6, B1_4_2_7
          , B1_4_3, B1_4_4, B1_4_5
          , B2_1, B2_2, B2_3, B2_4, B2_5, B2_6, B2
          , C1_1, C1_2, C1_3, C1_4, C1_5, C1_6, C1_7, C1_8, C1_9, C1, C2, D1, D2
          , USER_ID, USER_NAME, CREATE_DATE)
          values (#{code},#{courseCode},#{courseName},#{courseAttr},#{xn},#{xq},#{xyName},#{zyName},#{skjsAll},#{skbjAll}
            ,#{b1_1_1},#{b1_1_2},#{b1_1_3},#{b1_1_4_1},#{b1_1_4_2},#{b1_1_5}
            ,#{b1_1_6_1},#{b1_1_6_2},#{b1_1_6_3},#{b1_1_6_4},#{b1_1_6_5},#{b1_1_6_6},#{b1_1_6_7}
            ,#{b1_1_7_1},#{b1_1_7_2},#{b1_1_7_3},#{b1_1_7_4},#{b1_1_7_5},#{b1_1_7_6},#{b1_1_7_7}
            ,#{b1_1_8},#{b1_1_9},#{b1_1_10}
            ,#{b1_2_1_1},#{b1_2_1_2},#{b1_2_1_3},#{b1_2_1_4},#{b1_2_1_5},#{b1_2_1_6},#{b1_2_1_7}
            ,#{b1_2_2_1},#{b1_2_2_2},#{b1_2_2_3},#{b1_2_2_4},#{b1_2_2_5},#{b1_2_2_6},#{b1_2_2_7}
            ,#{b1_2_3},#{b1_2_4},#{b1_2_5}
            ,#{b1_3_1_1},#{b1_3_1_2},#{b1_3_1_3},#{b1_3_1_4},#{b1_3_1_5},#{b1_3_1_6},#{b1_3_1_7}
            ,#{b1_3_2_1},#{b1_3_2_2},#{b1_3_2_3},#{b1_3_2_4},#{b1_3_2_5},#{b1_3_2_6},#{b1_3_2_7}
            ,#{b1_3_3},#{b1_3_4},#{b1_3_5}
            ,#{b1_4_1_1},#{b1_4_1_2},#{b1_4_1_3},#{b1_4_1_4},#{b1_4_1_5},#{b1_4_1_6},#{b1_4_1_7}
            ,#{b1_4_2_1},#{b1_4_2_2},#{b1_4_2_3},#{b1_4_2_4},#{b1_4_2_5},#{b1_4_2_6},#{b1_4_2_7}
            ,#{b1_4_3},#{b1_4_4},#{b1_4_5}
            ,#{b2_1},#{b2_2},#{b2_3},#{b2_4},#{b2_5},#{b2_6},#{b2}
            ,#{c1_1},#{c1_2},#{c1_3},#{c1_4},#{c1_5},#{c1_6},#{c1_7},#{c1_8},#{c1_9},#{c1},#{c2},#{d1},#{d2}
          ,#{userId},#{userName},CURRENT_DATE)
    </insert>

    <update id="update">
        update JXXG_KCZLFXBG
        <set>
            <if test="courseCode != null and courseCode != ''">
                COURSE_CODE = #{courseCode}
            </if>
            <if test="courseName != null and courseName != ''">
                , COURSE_NAME = #{courseName}
            </if>
            <if test="courseAttr != null and courseAttr != ''">
                , COURSE_ATTR = #{courseAttr}
            </if>
        </set>
        where code = #{code}
    </update>

    <delete id="delete">
        delete from JXXG_KCZLFXBG where code = #{code}
    </delete>

</mapper>